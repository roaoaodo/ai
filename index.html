<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Riteom AI</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a0f;
  --surface: #12121a;
  --border: #1e1e2e;
  --accent: #7c3aed;
  --accent2: #06b6d4;
  --text: #e2e8f0;
  --muted: #64748b;
  --danger: #ef4444;
  --gold: #f59e0b;
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  background:var(--bg); color:var(--text);
  font-family:'JetBrains Mono',monospace;
  height:100vh; display:flex; flex-direction:column; overflow:hidden;
}
body::before {
  content:''; position:fixed; inset:0;
  background:
    radial-gradient(ellipse 80% 50% at 20% -20%,rgba(124,58,237,.13) 0%,transparent 60%),
    radial-gradient(ellipse 60% 40% at 80% 110%,rgba(6,182,212,.09) 0%,transparent 50%);
  pointer-events:none; z-index:0;
}

/* ‚ïê‚ïê HEADER ‚ïê‚ïê */
header {
  position:relative; z-index:10;
  display:flex; align-items:center; gap:10px;
  padding:12px 20px;
  border-bottom:1px solid var(--border);
  background:rgba(10,10,15,.9);
  backdrop-filter:blur(20px); flex-shrink:0;
}
#menuBtn {
  width:34px; height:34px;
  display:flex; flex-direction:column;
  align-items:center; justify-content:center; gap:5px;
  cursor:pointer; background:none; border:none;
  border-radius:9px; transition:background .2s; flex-shrink:0;
}
#menuBtn:hover { background:rgba(255,255,255,.07); }
#menuBtn span { display:block; width:18px; height:2px; background:var(--muted); border-radius:2px; }

.logo { width:28px; height:28px; flex-shrink:0; }
.logo svg { width:100%; height:100%; }
.logo-ring { animation:spin 8s linear infinite; transform-origin:center; }
@keyframes spin { to { transform:rotate(360deg); } }

/* Request counter in header */
#reqCounter {
  display:flex; align-items:center; gap:6px;
  padding:4px 10px; border-radius:100px;
  border:1px solid var(--border); background:var(--surface);
  font-size:0.6rem; color:var(--muted); flex-shrink:0;
  transition:all .3s;
}
#reqCounter .rc-num { color:#a78bfa; font-weight:700; }
#reqCounter.milestone { border-color:var(--gold); background:rgba(245,158,11,.08); }
#reqCounter.milestone .rc-num { color:var(--gold); }

.h-info { flex:1; min-width:0; }
.h-title {
  font-family:'Syne',sans-serif; font-weight:800; font-size:1rem; letter-spacing:.06em;
  background:linear-gradient(135deg,#a78bfa,#06b6d4);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.h-sub { font-size:.58rem; color:var(--muted); letter-spacing:.12em; text-transform:uppercase; }
.h-right { display:flex; align-items:center; gap:8px; flex-shrink:0; }
.model-badge {
  padding:4px 10px; border-radius:100px;
  border:1px solid var(--border); font-size:.6rem; color:var(--muted);
  cursor:pointer; transition:all .2s; background:var(--surface); white-space:nowrap;
}
.model-badge:hover { border-color:var(--accent); color:#a78bfa; }
.sdot {
  width:7px; height:7px; border-radius:50%;
  background:#22c55e; box-shadow:0 0 8px #22c55e;
  animation:pulse 2s ease-in-out infinite; flex-shrink:0;
}
.sdot.loading { background:var(--gold); box-shadow:0 0 8px var(--gold); }
.sdot.error { background:var(--danger); box-shadow:0 0 8px var(--danger); animation:none; }
@keyframes pulse { 0%,100%{opacity:1}50%{opacity:.4} }

/* ‚ïê‚ïê MODEL DROPDOWN ‚ïê‚ïê */
.msel {
  position:fixed; top:58px; right:20px;
  background:var(--surface); border:1px solid var(--border);
  border-radius:12px; overflow:hidden; z-index:300;
  display:none; flex-direction:column;
  box-shadow:0 20px 50px rgba(0,0,0,.7); min-width:270px; max-height:400px;
}
.msel.open { display:flex; animation:fadeDown .15s ease; }
@keyframes fadeDown { from{opacity:0;transform:translateY(-6px)} to{opacity:1;transform:translateY(0)} }
.msel-scroll { overflow-y:auto; flex:1; }
.msel-scroll::-webkit-scrollbar { width:3px; }
.msel-scroll::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }
.msel-group {
  padding:7px 15px 4px; font-size:.58rem; font-weight:700;
  letter-spacing:.14em; text-transform:uppercase;
  color:var(--muted); background:rgba(255,255,255,.02);
  border-bottom:1px solid var(--border);
}
.mo {
  padding:10px 15px; font-size:.74rem; cursor:pointer;
  transition:background .15s; border-bottom:1px solid var(--border);
  display:flex; flex-direction:column; gap:2px;
}
.mo:last-child { border-bottom:none; }
.mo:hover { background:rgba(124,58,237,.1); }
.mo.active { background:rgba(124,58,237,.16); }
.mo .mn { color:#a78bfa; font-weight:500; }
.mo .md2 { color:var(--muted); font-size:.6rem; }

/* ‚ïê‚ïê OVERLAYS SHARED ‚ïê‚ïê */
.overlay {
  position:fixed; inset:0; z-index:500;
  display:none; align-items:center; justify-content:center;
  background:rgba(0,0,0,.75); backdrop-filter:blur(6px);
}
.overlay.open { display:flex; animation:ovIn .2s ease; }
@keyframes ovIn { from{opacity:0} to{opacity:1} }

.panel {
  width:520px; max-width:95vw; max-height:85vh;
  background:var(--surface); border:1px solid var(--border);
  border-radius:20px; display:flex; flex-direction:column;
  box-shadow:0 40px 80px rgba(0,0,0,.7);
  animation:panelIn .25s cubic-bezier(.34,1.56,.64,1); overflow:hidden;
}
@keyframes panelIn { from{opacity:0;transform:scale(.93) translateY(20px)} to{opacity:1;transform:scale(1) translateY(0)} }

.p-head {
  padding:16px 20px 13px; border-bottom:1px solid var(--border);
  display:flex; align-items:center; gap:12px; flex-shrink:0;
}
.p-title {
  font-family:'Syne',sans-serif; font-size:1rem; font-weight:700;
  background:linear-gradient(135deg,#a78bfa,#06b6d4);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent; flex:1;
}
.p-close {
  width:30px; height:30px; border-radius:8px;
  background:rgba(255,255,255,.05); border:1px solid var(--border);
  color:var(--muted); cursor:pointer; font-size:1rem;
  display:flex; align-items:center; justify-content:center; transition:all .2s;
}
.p-close:hover { background:rgba(239,68,68,.1); color:#f87171; border-color:rgba(239,68,68,.3); }

/* ‚ïê‚ïê CHAT LIST PANEL ‚ïê‚ïê */
.cp-new { padding:10px 20px; border-bottom:1px solid var(--border); flex-shrink:0; }
.new-chat-btn {
  width:100%; display:flex; align-items:center; justify-content:center; gap:8px;
  padding:9px 14px; border-radius:10px;
  border:1px dashed rgba(124,58,237,.5); background:rgba(124,58,237,.06);
  color:#a78bfa; font-family:'JetBrains Mono',monospace;
  font-size:.76rem; cursor:pointer; transition:all .2s;
}
.new-chat-btn:hover { background:rgba(124,58,237,.14); border-color:rgba(124,58,237,.8); }

/* Profile button in chat panel header */
.profile-btn-row {
  padding:8px 20px 0; flex-shrink:0;
}
.profile-nav-btn {
  width:100%; display:flex; align-items:center; gap:10px;
  padding:10px 14px; border-radius:10px;
  border:1px solid var(--border); background:rgba(255,255,255,.03);
  color:var(--text); font-family:'JetBrains Mono',monospace;
  font-size:.76rem; cursor:pointer; transition:all .2s; margin-bottom:8px;
}
.profile-nav-btn:hover { background:rgba(124,58,237,.1); border-color:rgba(124,58,237,.4); color:#a78bfa; }
.profile-nav-btn .pnb-av {
  width:26px; height:26px; border-radius:8px;
  background:linear-gradient(135deg,#7c3aed,#a855f7);
  display:flex; align-items:center; justify-content:center;
  font-size:.7rem; flex-shrink:0; overflow:hidden;
}
.profile-nav-btn .pnb-av img { width:100%; height:100%; object-fit:cover; border-radius:8px; }

.cp-list { flex:1; overflow-y:auto; padding:8px; display:flex; flex-direction:column; gap:2px; }
.cp-list::-webkit-scrollbar { width:3px; }
.cp-list::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }

.ci {
  display:flex; align-items:center; gap:10px;
  padding:10px 12px; border-radius:12px; cursor:pointer;
  transition:background .15s; border:1px solid transparent;
}
.ci:hover { background:rgba(255,255,255,.04); }
.ci.active { background:rgba(124,58,237,.12); border-color:rgba(124,58,237,.3); }
.ci-icon { font-size:1rem; flex-shrink:0; }
.ci-body { flex:1; min-width:0; }
.ci-name { font-size:.8rem; color:var(--text); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.ci.active .ci-name { color:#c4b5fd; }
.ci-meta { font-size:.62rem; color:var(--muted); margin-top:2px; }
.ci-inp {
  width:100%; background:rgba(255,255,255,.06); border:1px solid var(--accent);
  border-radius:7px; color:var(--text); font-family:'JetBrains Mono',monospace;
  font-size:.78rem; padding:4px 8px; outline:none;
}
.ci-actions { display:flex; gap:4px; flex-shrink:0; }
.ci-btn {
  width:28px; height:28px; border-radius:7px;
  background:none; border:none; cursor:pointer;
  display:flex; align-items:center; justify-content:center;
  font-size:.78rem; transition:all .15s; color:var(--muted); opacity:0;
}
.ci:hover .ci-btn { opacity:1; }
.ci-btn.edit:hover { background:rgba(124,58,237,.15); color:#a78bfa; }
.ci-btn.del:hover { background:rgba(239,68,68,.12); color:#f87171; }
.ci-btn.save { opacity:1; background:rgba(34,197,94,.12); color:#4ade80; }
.ci-btn.save:hover { background:rgba(34,197,94,.22); }
.ci-btn.cancel { opacity:1; }
.ci-btn.cancel:hover { background:rgba(239,68,68,.12); color:#f87171; }
.cp-empty { padding:40px 20px; text-align:center; color:var(--muted); font-size:.78rem; line-height:1.7; }
.cp-empty span { font-size:2rem; display:block; margin-bottom:10px; opacity:.4; }

/* ‚ïê‚ïê PROFILE PANEL ‚ïê‚ïê */
.prof-body { flex:1; overflow-y:auto; padding:20px; display:flex; flex-direction:column; gap:20px; }
.prof-body::-webkit-scrollbar { width:3px; }
.prof-body::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }

.prof-avatar-section { display:flex; align-items:center; gap:16px; }
.prof-av {
  width:72px; height:72px; border-radius:18px; flex-shrink:0;
  background:linear-gradient(135deg,#7c3aed,#a855f7);
  display:flex; align-items:center; justify-content:center;
  font-size:1.8rem; overflow:hidden; cursor:pointer;
  border:2px solid rgba(124,58,237,.4); transition:all .2s; position:relative;
}
.prof-av:hover { border-color:#a78bfa; }
.prof-av img { width:100%; height:100%; object-fit:cover; border-radius:16px; }
.prof-av-hint { font-size:.65rem; color:var(--muted); margin-top:5px; }
.prof-av-actions { display:flex; flex-direction:column; gap:6px; }
.prof-av-btn {
  padding:6px 14px; border-radius:8px;
  background:rgba(124,58,237,.1); border:1px solid rgba(124,58,237,.3);
  color:#a78bfa; font-family:'JetBrains Mono',monospace;
  font-size:.72rem; cursor:pointer; transition:all .2s;
}
.prof-av-btn:hover { background:rgba(124,58,237,.2); }
.prof-av-btn.danger { background:rgba(239,68,68,.08); border-color:rgba(239,68,68,.25); color:#f87171; }
.prof-av-btn.danger:hover { background:rgba(239,68,68,.16); }

.prof-field label { display:block; font-size:.65rem; color:var(--muted); letter-spacing:.1em; text-transform:uppercase; margin-bottom:6px; }
.prof-field input {
  width:100%; background:rgba(255,255,255,.05); border:1px solid var(--border);
  border-radius:10px; color:var(--text); font-family:'JetBrains Mono',monospace;
  font-size:.85rem; padding:10px 14px; outline:none; transition:all .2s;
}
.prof-field input:focus { border-color:rgba(124,58,237,.5); box-shadow:0 0 0 3px rgba(124,58,237,.07); }

.prof-save-btn {
  width:100%; padding:11px; border-radius:11px; border:none;
  background:linear-gradient(135deg,#7c3aed,#06b6d4);
  color:#fff; font-family:'JetBrains Mono',monospace;
  font-size:.8rem; cursor:pointer; transition:all .2s;
}
.prof-save-btn:hover { filter:brightness(1.1); }

/* Stats row */
.prof-stats {
  display:grid; grid-template-columns:1fr 1fr; gap:10px;
}
.stat-card {
  background:rgba(255,255,255,.03); border:1px solid var(--border);
  border-radius:12px; padding:12px 14px;
}
.stat-card .sc-val { font-family:'Syne',sans-serif; font-size:1.4rem; font-weight:800; color:#a78bfa; }
.stat-card .sc-label { font-size:.62rem; color:var(--muted); margin-top:3px; }

/* NFT section */
.nft-section-title {
  font-family:'Syne',sans-serif; font-size:.75rem; font-weight:700;
  letter-spacing:.12em; text-transform:uppercase; color:var(--muted);
  display:flex; align-items:center; gap:8px;
}
.nft-section-title::after { content:''; flex:1; height:1px; background:var(--border); }

.nft-grid { display:flex; flex-direction:column; gap:8px; }
.nft-empty { color:var(--muted); font-size:.75rem; text-align:center; padding:16px; opacity:.6; }

.nft-card {
  display:flex; align-items:center; gap:12px;
  background:rgba(255,255,255,.03); border:1px solid var(--border);
  border-radius:12px; padding:12px 14px; transition:all .2s;
}
.nft-card:hover { border-color:rgba(124,58,237,.3); background:rgba(124,58,237,.05); }
.nft-emoji { font-size:1.8rem; flex-shrink:0; }
.nft-info { flex:1; min-width:0; }
.nft-name { font-size:.8rem; color:var(--text); font-weight:600; }
.nft-sub { font-size:.64rem; color:var(--muted); margin-top:2px; }
.nft-val {
  font-family:'Syne',sans-serif; font-size:.95rem; font-weight:800;
  color:var(--gold); flex-shrink:0;
}

/* ‚ïê‚ïê ACTIVATION KEY ‚ïê‚ïê */
.key-btn-row {
  padding:6px 20px 10px; flex-shrink:0;
}
.key-nav-btn {
  width:100%; display:flex; align-items:center; gap:10px;
  padding:10px 14px; border-radius:10px;
  border:1px solid rgba(245,158,11,.35); background:rgba(245,158,11,.06);
  color:#fbbf24; font-family:'JetBrains Mono',monospace;
  font-size:.76rem; cursor:pointer; transition:all .2s; margin-bottom:0;
}
.key-nav-btn:hover { background:rgba(245,158,11,.14); border-color:rgba(245,158,11,.6); }
.key-nav-btn.activated { border-color:rgba(34,197,94,.4); background:rgba(34,197,94,.07); color:#4ade80; }

/* Key input overlay */
#keyOverlay .panel { max-width:400px; }
.key-body { padding:24px 20px; display:flex; flex-direction:column; gap:16px; }
.key-field label { display:block; font-size:.65rem; color:var(--muted); letter-spacing:.1em; text-transform:uppercase; margin-bottom:6px; }
.key-field input {
  width:100%; background:rgba(255,255,255,.05); border:1px solid var(--border);
  border-radius:10px; color:var(--text); font-family:'JetBrains Mono',monospace;
  font-size:.85rem; padding:10px 14px; outline:none; transition:all .2s; letter-spacing:.06em;
}
.key-field input:focus { border-color:rgba(245,158,11,.5); box-shadow:0 0 0 3px rgba(245,158,11,.07); }
.key-submit-btn {
  width:100%; padding:11px; border-radius:11px; border:none;
  background:linear-gradient(135deg,#b45309,#f59e0b);
  color:#fff; font-family:'JetBrains Mono',monospace;
  font-size:.8rem; cursor:pointer; transition:all .2s;
}
.key-submit-btn:hover { filter:brightness(1.1); }
.key-err { color:#f87171; font-size:.75rem; text-align:center; display:none; }
.key-ok { color:#4ade80; font-size:.75rem; text-align:center; display:none; }

/* ‚ïê‚ïê ADMIN PANEL ‚ïê‚ïê */
#adminOverlay .panel { width:580px; max-width:96vw; }
.admin-body { flex:1; overflow-y:auto; padding:20px; display:flex; flex-direction:column; gap:18px; }
.admin-body::-webkit-scrollbar { width:3px; }
.admin-body::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }
.admin-section-title {
  font-family:'Syne',sans-serif; font-size:.75rem; font-weight:700;
  letter-spacing:.12em; text-transform:uppercase; color:#fbbf24;
  display:flex; align-items:center; gap:8px;
}
.admin-section-title::after { content:''; flex:1; height:1px; background:rgba(245,158,11,.25); }
.admin-field label { display:block; font-size:.65rem; color:var(--muted); letter-spacing:.1em; text-transform:uppercase; margin-bottom:6px; }
.admin-field input, .admin-field select {
  width:100%; background:rgba(255,255,255,.05); border:1px solid var(--border);
  border-radius:10px; color:var(--text); font-family:'JetBrains Mono',monospace;
  font-size:.85rem; padding:10px 14px; outline:none; transition:all .2s;
}
.admin-field input:focus, .admin-field select:focus { border-color:rgba(245,158,11,.5); box-shadow:0 0 0 3px rgba(245,158,11,.07); }
.admin-field select { cursor:pointer; }
.admin-field select option { background:var(--surface); }
.admin-btn {
  padding:10px 18px; border-radius:10px; border:none; cursor:pointer;
  font-family:'JetBrains Mono',monospace; font-size:.78rem; transition:all .2s;
}
.admin-btn.primary { background:linear-gradient(135deg,#7c3aed,#a855f7); color:#fff; }
.admin-btn.gold { background:linear-gradient(135deg,#b45309,#f59e0b); color:#fff; }
.admin-btn:hover { filter:brightness(1.1); transform:translateY(-1px); }
.admin-btn:active { transform:translateY(0); }
.admin-nft-list { display:flex; flex-direction:column; gap:6px; max-height:220px; overflow-y:auto; }
.admin-nft-list::-webkit-scrollbar { width:3px; }
.admin-nft-list::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }
.admin-nft-row {
  display:flex; align-items:center; gap:10px;
  background:rgba(255,255,255,.03); border:1px solid var(--border);
  border-radius:10px; padding:9px 12px;
}
.admin-nft-row .anr-emoji { font-size:1.3rem; flex-shrink:0; }
.admin-nft-row .anr-name { flex:1; font-size:.78rem; color:var(--text); }
.admin-nft-row .anr-del {
  width:26px; height:26px; border-radius:7px; background:rgba(239,68,68,.1);
  border:1px solid rgba(239,68,68,.25); color:#f87171; cursor:pointer;
  font-size:.8rem; display:flex; align-items:center; justify-content:center; transition:all .2s;
}
.admin-nft-row .anr-del:hover { background:rgba(239,68,68,.2); }
.admin-msg { font-size:.75rem; padding:8px 12px; border-radius:8px; text-align:center; display:none; }
.admin-msg.success { background:rgba(34,197,94,.1); color:#4ade80; border:1px solid rgba(34,197,94,.2); }
.admin-msg.err { background:rgba(239,68,68,.1); color:#f87171; border:1px solid rgba(239,68,68,.2); }

/* ‚ïê‚ïê GIFT TOAST ‚ïê‚ïê */
#giftToast {
  position:fixed; bottom:90px; left:50%; transform:translateX(-50%) translateY(20px);
  background:var(--surface); border:1px solid var(--gold);
  border-radius:16px; padding:14px 22px;
  display:flex; align-items:center; gap:12px;
  box-shadow:0 10px 40px rgba(245,158,11,.25);
  z-index:1000; opacity:0; pointer-events:none;
  transition:all .4s cubic-bezier(.34,1.56,.64,1);
  white-space:nowrap;
}
#giftToast.show { opacity:1; transform:translateX(-50%) translateY(0); pointer-events:auto; }
#giftToast .gt-emoji { font-size:1.8rem; }
#giftToast .gt-text { font-size:.8rem; }
#giftToast .gt-text strong { color:var(--gold); display:block; font-size:.9rem; }

/* ‚ïê‚ïê CHAT AREA ‚ïê‚ïê */
#chat {
  flex:1; overflow-y:auto; padding:22px 28px;
  display:flex; flex-direction:column; gap:18px;
  scroll-behavior:smooth; position:relative; z-index:1;
}
#chat::-webkit-scrollbar { width:4px; }
#chat::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }

.msg { display:flex; gap:11px; animation:slideIn .28s cubic-bezier(.34,1.56,.64,1) both; max-width:840px; }
@keyframes slideIn { from{opacity:0;transform:translateY(14px) scale(.97)} to{opacity:1;transform:translateY(0) scale(1)} }
.msg.user { flex-direction:row-reverse; align-self:flex-end; }
.msg.ai { align-self:flex-start; }

.av {
  width:30px; height:30px; border-radius:9px;
  display:flex; align-items:center; justify-content:center;
  font-size:.62rem; font-weight:700; flex-shrink:0;
  font-family:'Syne',sans-serif; overflow:hidden;
}
.msg.user .av { background:linear-gradient(135deg,#7c3aed,#a855f7); color:#fff; }
.msg.user .av img { width:100%; height:100%; object-fit:cover; border-radius:9px; }
.msg.ai .av { background:linear-gradient(135deg,#0e7490,#06b6d4); color:#fff; }

.bubble {
  padding:12px 16px; border-radius:16px;
  font-size:.875rem; line-height:1.78; max-width:680px; word-break:break-word;
}
.msg.user .bubble { background:#1e1e3a; border:1px solid rgba(124,58,237,.3); border-top-right-radius:4px; color:#c4b5fd; }
.msg.ai .bubble { background:var(--surface); border:1px solid var(--border); border-top-left-radius:4px; color:var(--text); }

.bubble strong { color:#a78bfa; font-weight:600; }
.bubble em { color:#06b6d4; font-style:italic; }
.bubble code {
  background:rgba(124,58,237,.15); border:1px solid rgba(124,58,237,.2);
  padding:1px 6px; border-radius:4px; font-size:.82em; color:#a78bfa;
  font-family:'JetBrains Mono',monospace;
}
.bubble pre { background:#0d0d16; border:1px solid var(--border); border-radius:10px; padding:13px; margin:10px 0; overflow-x:auto; font-size:.82em; line-height:1.6; }
.bubble pre code { background:none; border:none; padding:0; color:#7dd3fc; }
.bubble ul,.bubble ol { padding-left:20px; margin:6px 0; }
.bubble li { margin:4px 0; }
.bubble h1,.bubble h2,.bubble h3 { font-family:'Syne',sans-serif; color:#a78bfa; margin:10px 0 5px; }
.bubble h1{font-size:1.1em} .bubble h2{font-size:1em} .bubble h3{font-size:.95em}
.bubble blockquote { border-left:3px solid var(--accent); padding-left:12px; color:var(--muted); margin:8px 0; }

.pre-wrap { position:relative; margin:10px 0; }
.pre-wrap pre { margin:0; }
.copy-btn {
  position:absolute; top:8px; right:8px; padding:3px 10px; border-radius:6px;
  background:rgba(124,58,237,.2); border:1px solid rgba(124,58,237,.35);
  color:#a78bfa; font-family:'JetBrains Mono',monospace;
  font-size:.65rem; cursor:pointer; transition:all .2s; line-height:1.6;
}
.copy-btn:hover { background:rgba(124,58,237,.38); }
.copy-btn.copied { background:rgba(34,197,94,.2); border-color:rgba(34,197,94,.4); color:#4ade80; }

.typing { display:flex; align-items:center; gap:5px; padding:14px 16px; }
.typing span { width:6px; height:6px; border-radius:50%; background:var(--accent2); animation:bounce 1.2s ease-in-out infinite; }
.typing span:nth-child(2){animation-delay:.2s} .typing span:nth-child(3){animation-delay:.4s}
@keyframes bounce{0%,80%,100%{transform:translateY(0);opacity:.4}40%{transform:translateY(-6px);opacity:1}}

.err-bubble {
  background:rgba(239,68,68,.1); border:1px solid rgba(239,68,68,.3);
  color:#fca5a5; border-radius:12px; padding:10px 16px; font-size:.78rem;
  align-self:center; animation:slideIn .3s ease; max-width:480px; text-align:center;
}

.welcome {
  flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap:18px; text-align:center; padding:40px; animation:fadeIn .45s ease both;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.wi { width:64px; height:64px; border-radius:18px; background:linear-gradient(135deg,rgba(124,58,237,.2),rgba(6,182,212,.2)); border:1px solid rgba(124,58,237,.3); display:flex; align-items:center; justify-content:center; font-size:1.8rem; }
.welcome h1 { font-family:'Syne',sans-serif; font-size:1.8rem; font-weight:800; background:linear-gradient(135deg,#a78bfa,#06b6d4); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.welcome p { color:var(--muted); font-size:.8rem; max-width:310px; line-height:1.65; }
.suggs { display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin-top:6px; }
.sug { padding:8px 14px; border-radius:100px; border:1px solid var(--border); background:var(--surface); color:var(--muted); font-size:.73rem; font-family:'JetBrains Mono',monospace; cursor:pointer; transition:all .2s; }
.sug:hover { border-color:var(--accent); color:#a78bfa; background:rgba(124,58,237,.08); transform:translateY(-2px); }

/* ‚ïê‚ïê FOOTER ‚ïê‚ïê */
footer { position:relative; z-index:10; padding:12px 20px 18px; border-top:1px solid var(--border); background:rgba(10,10,15,.92); backdrop-filter:blur(20px); flex-shrink:0; }
.inp-wrap { display:flex; align-items:flex-end; gap:8px; background:var(--surface); border:1px solid var(--border); border-radius:14px; padding:9px 12px; transition:border-color .2s,box-shadow .2s; }
.inp-wrap:focus-within { border-color:rgba(124,58,237,.5); box-shadow:0 0 0 3px rgba(124,58,237,.07); }
#inp { flex:1; background:none; border:none; outline:none; color:var(--text); font-family:'JetBrains Mono',monospace; font-size:.875rem; resize:none; max-height:140px; line-height:1.6; min-height:22px; }
#inp::placeholder { color:var(--muted); }
#sndBtn { width:34px; height:34px; border-radius:9px; border:none; background:linear-gradient(135deg,#7c3aed,#06b6d4); color:#fff; cursor:pointer; display:flex; align-items:center; justify-content:center; flex-shrink:0; transition:all .2s; }
#sndBtn:hover{transform:scale(1.05);filter:brightness(1.1)}
#sndBtn:active{transform:scale(.95)}
#sndBtn:disabled{opacity:.4;cursor:not-allowed;transform:none}
.fn { text-align:center; font-size:.6rem; color:var(--muted); margin-top:8px; opacity:.5; }
</style>
</head>
<body>

<!-- Gift toast -->
<div id="giftToast">
  <div class="gt-emoji" id="giftEmoji">üí™</div>
  <div class="gt-text">
    <strong id="giftTitle">–ù–æ–≤—ã–π –ø–æ–¥–∞—Ä–æ–∫!</strong>
    <span id="giftDesc">–ó–∞–≥–ª—è–Ω–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å ‚Üí NFT</span>
  </div>
</div>

<!-- Chat list overlay -->
<div class="overlay" id="chatOverlay">
  <div class="panel">
    <div class="p-head">
      <div class="p-title">üí¨ –ß–∞—Ç—ã</div>
      <button class="p-close" onclick="closeOverlay('chatOverlay')">‚úï</button>
    </div>
    <div class="profile-btn-row">
      <button class="profile-nav-btn" onclick="openProfile()">
        <div class="pnb-av" id="menuAvatar">üë§</div>
        <span id="menuName">–ü—Ä–æ—Ñ–∏–ª—å</span>
      </button>
    </div>
    <div class="key-btn-row">
      <button class="key-nav-btn" id="keyNavBtn" onclick="openKeyOverlay()">
        <span>üîë</span>
        <span id="keyNavLabel">–ö–ª—é—á –∞–∫—Ç–∏–≤–∞—Ü–∏–∏</span>
      </button>
    </div>
    <div class="cp-new">
      <button class="new-chat-btn" onclick="newChat()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —á–∞—Ç
      </button>
    </div>
    <div class="cp-list" id="chatListEl"></div>
  </div>
</div>

<!-- Profile overlay -->
<div class="overlay" id="profileOverlay">
  <div class="panel">
    <div class="p-head">
      <div class="p-title">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
      <button class="p-close" onclick="closeOverlay('profileOverlay')">‚úï</button>
    </div>
    <div class="prof-body">

      <!-- Avatar -->
      <div class="prof-avatar-section">
        <div>
          <div class="prof-av" id="profAvEl" onclick="document.getElementById('avFile').click()">üë§</div>
          <div class="prof-av-hint">–Ω–∞–∂–º–∏ —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å</div>
          <input type="file" id="avFile" accept="image/*" style="display:none" onchange="onAvatarFile(event)">
        </div>
        <div class="prof-av-actions">
          <button class="prof-av-btn" onclick="document.getElementById('avFile').click()">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</button>
          <button class="prof-av-btn danger" onclick="removeAvatar()">üóë –£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ</button>
        </div>
      </div>

      <!-- Name -->
      <div class="prof-field">
        <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
        <input type="text" id="profNameInp" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è‚Ä¶" maxlength="32">
      </div>

      <button class="prof-save-btn" onclick="saveProfile()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>

      <!-- Stats -->
      <div class="prof-stats">
        <div class="stat-card">
          <div class="sc-val" id="statTotal">0</div>
          <div class="sc-label">–≤—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤</div>
        </div>
        <div class="stat-card">
          <div class="sc-val" id="statNfts">0</div>
          <div class="sc-label">NFT –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏</div>
        </div>
      </div>

      <!-- NFT -->
      <div class="nft-section-title">üéÅ NFT –ö–æ–ª–ª–µ–∫—Ü–∏—è</div>
      <div class="nft-grid" id="nftGrid">
        <div class="nft-empty">–ü–æ–∫–∞ –Ω–µ—Ç NFT.<br>–î–µ–ª–∞–π –∑–∞–ø—Ä–æ—Å—ã —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å!</div>
      </div>

    </div>
  </div>
</div>

<!-- Key Activation overlay -->
<div class="overlay" id="keyOverlay">
  <div class="panel">
    <div class="p-head">
      <div class="p-title">üîë –ö–ª—é—á –∞–∫—Ç–∏–≤–∞—Ü–∏–∏</div>
      <button class="p-close" onclick="closeOverlay('keyOverlay')">‚úï</button>
    </div>
    <div class="key-body">
      <div class="key-field">
        <label>–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á –∞–∫—Ç–∏–≤–∞—Ü–∏–∏</label>
        <input type="password" id="keyInp" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á‚Ä¶" onkeydown="if(event.key==='Enter')submitKey()">
      </div>
      <div class="key-err" id="keyErr">‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.</div>
      <div class="key-ok" id="keyOk">‚úÖ –ö–ª—é—á –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ê–¥–º–∏–Ω–∫—É.</div>
      <button class="key-submit-btn" onclick="submitKey()">üîì –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>
  </div>
</div>

<!-- Admin overlay -->
<div class="overlay" id="adminOverlay">
  <div class="panel">
    <div class="p-head">
      <div class="p-title">‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
      <button class="p-close" onclick="closeOverlay('adminOverlay')">‚úï</button>
    </div>
    <div class="admin-body">

      <div class="admin-section-title">üë§ –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
      <div class="admin-field">
        <label>Username</label>
        <input type="text" id="adminNameInp" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è‚Ä¶" maxlength="32">
      </div>
      <button class="admin-btn primary" onclick="adminSaveName()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–º—è</button>
      <div class="admin-msg" id="adminNameMsg">‚úì –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!</div>

      <div class="admin-section-title">üéÅ –î–æ–±–∞–≤–∏—Ç—å NFT</div>
      <div class="admin-field">
        <label>–í—ã–±–µ—Ä–∏—Ç–µ NFT</label>
        <select id="adminNftSelect">
          <option value="0">üí™ –°–∏–ª–∞—á (100‚ÇΩ ¬∑ +20‚ÇΩ/–¥–µ–Ω—å)</option>
          <option value="1">‚úåÔ∏è –ú–∞—Å—Ç–µ—Ä (200‚ÇΩ ¬∑ +50‚ÇΩ/–¥–µ–Ω—å)</option>
          <option value="custom">‚ú® –°–≤–æ–π (–∫–∞—Å—Ç–æ–º–Ω—ã–π)</option>
        </select>
      </div>
      <div id="adminCustomNft" style="display:none; flex-direction:column; gap:10px;">
        <div class="admin-field">
          <label>Emoji</label>
          <input type="text" id="adminNftEmoji" placeholder="üèÜ" maxlength="4">
        </div>
        <div class="admin-field">
          <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
          <input type="text" id="adminNftName" placeholder="–õ–µ–≥–µ–Ω–¥–∞" maxlength="24">
        </div>
        <div class="admin-field">
          <label>–ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (‚ÇΩ)</label>
          <input type="number" id="adminNftVal" placeholder="500" min="1">
        </div>
        <div class="admin-field">
          <label>–†–æ—Å—Ç –≤ –¥–µ–Ω—å (‚ÇΩ)</label>
          <input type="number" id="adminNftGrow" placeholder="100" min="0">
        </div>
      </div>
      <div style="display:flex; gap:8px;">
        <button class="admin-btn gold" onclick="adminAddNft()">‚ûï –î–æ–±–∞–≤–∏—Ç—å NFT</button>
      </div>
      <div class="admin-msg" id="adminNftMsg"></div>

      <div class="admin-section-title">üìã –¢–µ–∫—É—â–∏–µ NFT</div>
      <div class="admin-nft-list" id="adminNftList"></div>

    </div>
  </div>
</div>

<!-- Header -->
<header>
  <button id="menuBtn" onclick="openOverlay('chatOverlay')">
    <span></span><span></span><span></span>
  </button>
  <div class="logo">
    <svg viewBox="0 0 36 36" fill="none">
      <circle cx="18" cy="18" r="15" stroke="#7c3aed" stroke-width="1" stroke-dasharray="4 2" class="logo-ring"/>
      <circle cx="18" cy="18" r="8" fill="url(#g1)"/>
      <circle cx="18" cy="18" r="3" fill="#fff" opacity="0.9"/>
      <defs>
        <linearGradient id="g1" x1="10" y1="10" x2="26" y2="26">
          <stop offset="0%" stop-color="#7c3aed"/>
          <stop offset="100%" stop-color="#06b6d4"/>
        </linearGradient>
      </defs>
    </svg>
  </div>
  <div class="h-info">
    <div class="h-title" id="hTitle">Riteom AI</div>
    <div class="h-sub">your intelligent assistant</div>
  </div>
  <div class="h-right">
    <div id="reqCounter"><span>üìä</span><span class="rc-num" id="rcNum">0</span><span>–∑–∞–ø—Ä.</span></div>
    <div class="model-badge" onclick="toggleModels()" id="mBadge">llama-3.3-70b ‚ñæ</div>
    <div class="sdot" id="sdot"></div>
  </div>
</header>

<!-- Model selector -->
<div class="msel" id="msel">
  <div class="msel-scroll">
    <div class="msel-group">‚ö° PRODUCTION</div>
    <div class="mo active" onclick="selModel('llama-3.3-70b-versatile','llama-3.3-70b')">
      <span class="mn">llama-3.3-70b-versatile</span><span class="md2">Meta ¬∑ 70B ¬∑ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è</span>
    </div>
    <div class="mo" onclick="selModel('llama-3.1-8b-instant','llama-3.1-8b-instant')">
      <span class="mn">llama-3.1-8b-instant</span><span class="md2">Meta ¬∑ 8B ¬∑ –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π</span>
    </div>
    <div class="mo" onclick="selModel('openai/gpt-oss-120b','gpt-oss-120b')">
      <span class="mn">openai/gpt-oss-120b</span><span class="md2">OpenAI OSS ¬∑ 120B ¬∑ –º–æ—â–Ω—ã–π</span>
    </div>
    <div class="mo" onclick="selModel('openai/gpt-oss-20b','gpt-oss-20b')">
      <span class="mn">openai/gpt-oss-20b</span><span class="md2">OpenAI OSS ¬∑ 20B ¬∑ –±—ã—Å—Ç—Ä—ã–π</span>
    </div>
    <div class="msel-group">üî¨ PREVIEW</div>
    <div class="mo" onclick="selModel('meta-llama/llama-4-maverick-17b-128e-instruct','llama-4-maverick')">
      <span class="mn">llama-4-maverick-17b</span><span class="md2">Meta Llama 4 ¬∑ 128 —ç–∫—Å–ø–µ—Ä—Ç–æ–≤</span>
    </div>
    <div class="mo" onclick="selModel('meta-llama/llama-4-scout-17b-16e-instruct','llama-4-scout')">
      <span class="mn">llama-4-scout-17b</span><span class="md2">Meta Llama 4 Scout ¬∑ –ª—ë–≥–∫–∏–π</span>
    </div>
    <div class="msel-group">üß† REASONING</div>
    <div class="mo" onclick="selModel('qwen/qwen3-32b','qwen3-32b')">
      <span class="mn">qwen3-32b</span><span class="md2">Qwen 3 ¬∑ 32B ¬∑ reasoning</span>
    </div>
  </div>
</div>

<!-- Chat -->
<div id="chat"></div>

<!-- Footer -->
<footer>
  <div class="inp-wrap">
    <textarea id="inp" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶" rows="1"
      onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
    <button id="sndBtn" onclick="sendMsg()">
      <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
        <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
      </svg>
    </button>
  </div>
  <div class="fn">Riteom AI</div>
</footer>

<script>
const GROQ_KEY = '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';
const GROQ_URL = 'https://api.groq.com/openai/v1/chat/completions';
const SYS = `–¢—ã ‚Äî Riteom AI, —É–º–Ω—ã–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –ù–µ —É–ø–æ–º–∏–Ω–∞–π –Ω–∏–∫–∞–∫–∏–µ –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã, API –∏–ª–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å. –ï—Å–ª–∏ —Å–ø—Ä–æ—Å—è—Ç –∫—Ç–æ —Ç–µ–±—è —Å–æ–∑–¥–∞–ª ‚Äî –æ—Ç–≤–µ—á–∞–π —á—Ç–æ —Ç—ã Riteom AI. –û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –ø–æ-—Ä—É—Å—Å–∫–∏. –ë—É–¥—å —É–º–Ω—ã–º, –ø–æ–ª–µ–∑–Ω—ã–º, —Ç–æ—á–Ω—ã–º –∏ –Ω–µ–º–Ω–æ–≥–æ —Ö–∞—Ä–∏–∑–º–∞—Ç–∏—á–Ω—ã–º. –ò—Å–ø–æ–ª—å–∑—É–π markdown –≥–¥–µ —É–º–µ—Å—Ç–Ω–æ ‚Äî –∑–∞–≥–æ–ª–æ–≤–∫–∏, —Å–ø–∏—Å–∫–∏, –∫–æ–¥. –û—Ç–≤–µ—á–∞–π —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ.`;

let model = 'llama-3.3-70b-versatile';
let loading = false;
let spamLock = false; // 4-—Å–µ–∫—É–Ω–¥–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
let activeCid = null;

const chatEl = document.getElementById('chat');
const inpEl = document.getElementById('inp');
const sndBtn = document.getElementById('sndBtn');
const sdot = document.getElementById('sdot');
const titleEl = document.getElementById('hTitle');
const listEl = document.getElementById('chatListEl');

// ‚ïê‚ïê NFT DEFINITIONS ‚ïê‚ïê
const NFT_DEFS = [
  { emoji:'üí™', name:'–°–∏–ª–∞—á', rarity:'–ö–∞–∂–¥—ã–µ 20 –∑–∞–ø—Ä–æ—Å–æ–≤', baseVal:100, dailyGrow:20, trigger:'every20' },
  { emoji:'‚úåÔ∏è', name:'–ú–∞—Å—Ç–µ—Ä', rarity:'–ö–∞–∂–¥—ã–µ 100 –∑–∞–ø—Ä–æ—Å–æ–≤', baseVal:200, dailyGrow:50, trigger:'every100' }
];

// ‚ïê‚ïê LOCALSTORAGE ‚ïê‚ïê
function ls(k, def) { try { const v=localStorage.getItem(k); return v!=null?JSON.parse(v):def; } catch{return def;} }
function lss(k, v) { localStorage.setItem(k, JSON.stringify(v)); }

function allChats() { return ls('nova_chats',[]); }
function saveChats(cs) { lss('nova_chats',cs); }
function getChat(id) { return allChats().find(c=>c.id===id)||null; }
function patchChat(id,p) { const cs=allChats(),i=cs.findIndex(c=>c.id===id); if(i!==-1){cs[i]={...cs[i],...p};saveChats(cs);} }
function delChat(id) { saveChats(allChats().filter(c=>c.id!==id)); }
function mkChat(title='–ù–æ–≤—ã–π —á–∞—Ç') {
  const id='c'+Date.now(), c={id,title,messages:[],ts:Date.now()};
  const cs=allChats(); cs.unshift(c); saveChats(cs); return c;
}

// ‚ïê‚ïê REQUESTS COUNTER ‚ïê‚ïê
function getTotalReqs() { return ls('riteom_reqs', 0); }
function incReqs() {
  const prev = getTotalReqs();
  const next = prev + 1;
  lss('riteom_reqs', next);
  updateCounterUI(next);
  checkGifts(prev, next);
  return next;
}
function updateCounterUI(n) {
  const num = document.getElementById('rcNum');
  if (num) num.textContent = n;
  const ctr = document.getElementById('reqCounter');
  if (ctr) ctr.classList.toggle('milestone', n>0 && n%20===0);
}

// ‚ïê‚ïê NFT SYSTEM ‚ïê‚ïê
function getNfts() { return ls('riteom_nfts', []); }
function saveNfts(nfts) { lss('riteom_nfts', nfts); }

function checkGifts(prev, next) {
  // every20 gift
  if (Math.floor(next/20) > Math.floor(prev/20)) {
    addNft(0); // üí™
    showGiftToast(NFT_DEFS[0]);
  }
  // every100 gift
  if (Math.floor(next/100) > Math.floor(prev/100) && next >= 100) {
    addNft(1); // ‚úåÔ∏è
    showGiftToast(NFT_DEFS[1]);
  }
}

function addNft(defIdx) {
  const def = NFT_DEFS[defIdx];
  const nfts = getNfts();
  nfts.push({ defIdx, issuedAt: Date.now() });
  saveNfts(nfts);
}

// –¶–µ–Ω–Ω–æ—Å—Ç—å NFT —Ä–∞—Å—Ç—ë—Ç –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
function nftCurrentValue(nft) {
  const def = NFT_DEFS[nft.defIdx];
  const daysElapsed = Math.floor((Date.now() - nft.issuedAt) / 86400000);
  return def.baseVal + daysElapsed * def.dailyGrow;
}

function showGiftToast(def) {
  document.getElementById('giftEmoji').textContent = def.emoji;
  document.getElementById('giftTitle').textContent = `–ü–æ–ª—É—á–µ–Ω NFT: ${def.name}!`;
  document.getElementById('giftDesc').textContent = `–¶–µ–Ω–Ω–æ—Å—Ç—å: ${def.baseVal}‚ÇΩ ¬∑ —Ä–∞—Å—Ç—ë—Ç +${def.dailyGrow}‚ÇΩ/–¥–µ–Ω—å`;
  const toast = document.getElementById('giftToast');
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 5000);
}

// ‚ïê‚ïê PROFILE ‚ïê‚ïê
function getProfile() { return ls('riteom_profile', { name:'', avatar:'' }); }
function saveProfileData(p) { lss('riteom_profile', p); }

function updateAvatarUI(avatar) {
  // Header avatar in profile btn
  const menuAv = document.getElementById('menuAvatar');
  if (menuAv) { menuAv.innerHTML = avatar ? `<img src="${avatar}">` : 'üë§'; }
  // Profile big avatar
  const profAv = document.getElementById('profAvEl');
  if (profAv) { profAv.innerHTML = avatar ? `<img src="${avatar}">` : 'üë§'; }
  // User bubbles
  document.querySelectorAll('.msg.user .av').forEach(av => {
    av.innerHTML = avatar ? `<img src="${avatar}" style="width:100%;height:100%;object-fit:cover;border-radius:9px">` : '–í–´';
  });
}

function onAvatarFile(e) {
  const file = e.target.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    const p = getProfile(); p.avatar = ev.target.result; saveProfileData(p);
    updateAvatarUI(p.avatar);
  };
  reader.readAsDataURL(file);
  e.target.value = '';
}

function removeAvatar() {
  const p = getProfile(); p.avatar = ''; saveProfileData(p);
  updateAvatarUI('');
}

function saveProfile() {
  const name = document.getElementById('profNameInp').value.trim();
  const p = getProfile(); p.name = name; saveProfileData(p);
  updateMenuName(name);
  const btn = document.querySelector('.prof-save-btn');
  const orig = btn.textContent;
  btn.textContent = '‚úì –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!';
  setTimeout(() => btn.textContent = orig, 1500);
}

function updateMenuName(name) {
  const el = document.getElementById('menuName');
  if (el) el.textContent = name || '–ü—Ä–æ—Ñ–∏–ª—å';
}

function openProfile() {
  closeOverlay('chatOverlay');
  // Fill fields
  const p = getProfile();
  document.getElementById('profNameInp').value = p.name || '';
  updateAvatarUI(p.avatar || '');
  // Stats
  document.getElementById('statTotal').textContent = getTotalReqs();
  const nfts = getNfts();
  document.getElementById('statNfts').textContent = nfts.length;
  // NFT grid
  renderNftGrid(nfts);
  openOverlay('profileOverlay');
}

function renderNftGrid(nfts) {
  const grid = document.getElementById('nftGrid');
  if (!nfts.length) {
    grid.innerHTML = '<div class="nft-empty">–ü–æ–∫–∞ –Ω–µ—Ç NFT.<br>–î–µ–ª–∞–π –∑–∞–ø—Ä–æ—Å—ã —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å!</div>';
    return;
  }
  grid.innerHTML = '';
  // Sort newest first
  [...nfts].reverse().forEach(nft => {
    const def = NFT_DEFS[nft.defIdx];
    const val = nftCurrentValue(nft);
    const d = new Date(nft.issuedAt).toLocaleDateString('ru-RU',{day:'numeric',month:'short'});
    const card = document.createElement('div');
    card.className = 'nft-card';
    card.innerHTML = `
      <div class="nft-emoji">${def.emoji}</div>
      <div class="nft-info">
        <div class="nft-name">${def.name}</div>
        <div class="nft-sub">–ü–æ–ª—É—á–µ–Ω ${d} ¬∑ +${def.dailyGrow}‚ÇΩ/–¥–µ–Ω—å</div>
      </div>
      <div class="nft-val">${val}‚ÇΩ</div>`;
    grid.appendChild(card);
  });
}

// ‚ïê‚ïê OVERLAYS ‚ïê‚ïê
function openOverlay(id) { document.getElementById(id).classList.add('open'); if(id==='chatOverlay') renderList(); }
function closeOverlay(id) { document.getElementById(id).classList.remove('open'); }

document.getElementById('chatOverlay').addEventListener('click', e => { if(e.target===document.getElementById('chatOverlay')) closeOverlay('chatOverlay'); });
document.getElementById('profileOverlay').addEventListener('click', e => { if(e.target===document.getElementById('profileOverlay')) closeOverlay('profileOverlay'); });

// ‚ïê‚ïê CHAT LIST ‚ïê‚ïê
function renderList() {
  const cs = allChats();
  if (!cs.length) { listEl.innerHTML='<div class="cp-empty"><span>üóÇÔ∏è</span>–ß–∞—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.<br>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π!</div>'; return; }
  listEl.innerHTML='';
  cs.forEach(c => {
    const el = document.createElement('div');
    el.className = 'ci'+(c.id===activeCid?' active':'');
    const ds = new Date(c.ts).toLocaleDateString('ru-RU',{day:'numeric',month:'short'});
    el.innerHTML = `
      <div class="ci-icon">${c.id===activeCid?'‚ñ∂':'üí¨'}</div>
      <div class="ci-body" id="body_${c.id}">
        <div class="ci-name">${esc(c.title)}</div>
        <div class="ci-meta">${ds} ¬∑ ${c.messages.length} —Å–æ–æ–±—â.</div>
      </div>
      <div class="ci-actions">
        <button class="ci-btn edit" onclick="startEdit(event,'${c.id}')">‚úèÔ∏è</button>
        <button class="ci-btn del" onclick="rmChat(event,'${c.id}')">üóëÔ∏è</button>
      </div>`;
    el.addEventListener('click', e => {
      if(e.target.closest('.ci-actions')) return;
      if(document.getElementById('edit_'+c.id)) return;
      loadChat(c.id); closeOverlay('chatOverlay');
    });
    listEl.appendChild(el);
  });
}

function startEdit(e,id) {
  e.stopPropagation();
  const c=getChat(id); if(!c) return;
  const bodyEl=document.getElementById('body_'+id), ciEl=bodyEl.closest('.ci');
  bodyEl.innerHTML=`<input class="ci-inp" id="edit_${id}" value="${esc(c.title)}" onclick="event.stopPropagation()" onkeydown="editKey(event,'${id}')">`;
  const inp=document.getElementById('edit_'+id); inp.focus(); inp.select();
  ciEl.querySelector('.ci-actions').innerHTML=`<button class="ci-btn save" onclick="saveEdit(event,'${id}')">‚úì</button><button class="ci-btn cancel" onclick="renderList()">‚úï</button>`;
}
function editKey(e,id) { if(e.key==='Enter') saveEdit(e,id); if(e.key==='Escape') renderList(); e.stopPropagation(); }
function saveEdit(e,id) {
  e.stopPropagation();
  const inp=document.getElementById('edit_'+id); if(!inp) return;
  const val=inp.value.trim()||'–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
  patchChat(id,{title:val});
  if(id===activeCid) titleEl.textContent=val;
  renderList();
}
function rmChat(e,id) {
  e.stopPropagation();
  if(!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —á–∞—Ç?')) return;
  delChat(id);
  if(activeCid===id) {
    const cs=allChats();
    if(cs.length) loadChat(cs[0].id);
    else { activeCid=null; showWelcome(); titleEl.textContent='Riteom AI'; }
  }
  renderList();
}

function newChat() {
  const c=mkChat(); activeCid=c.id;
  showWelcome(); titleEl.textContent='Riteom AI';
  renderList(); closeOverlay('chatOverlay'); inpEl.focus();
}

function loadChat(id) {
  activeCid=id;
  const c=getChat(id); if(!c) return;
  titleEl.textContent = c.title==='–ù–æ–≤—ã–π —á–∞—Ç'?'Riteom AI':c.title;
  chatEl.innerHTML='';
  if(!c.messages.length) showWelcome();
  else c.messages.forEach(m=>addBubble(m.role==='user'?'user':'ai', m.content, false));
}

// ‚ïê‚ïê MESSAGES ‚ïê‚ïê
function showWelcome() {
  chatEl.innerHTML=`<div class="welcome"><div class="wi">‚ú¶</div><h1>Riteom AI</h1><p>–£–º–Ω—ã–π –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç ‚Äî –º–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã, —Ä–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç.</p><div class="suggs"><button class="sug" onclick="qs('–û–±—ä—è—Å–Ω–∏ –∫–≤–∞–Ω—Ç–æ–≤—É—é –∑–∞–ø—É—Ç–∞–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏')">–ö–≤–∞–Ω—Ç–æ–≤–∞—è –∑–∞–ø—É—Ç–∞–Ω–Ω–æ—Å—Ç—å</button><button class="sug" onclick="qs('–ù–∞–ø–∏—à–∏ —Ñ—É–Ω–∫—Ü–∏—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –Ω–∞ Python')">–ö–æ–¥ –Ω–∞ Python</button><button class="sug" onclick="qs('–ü—Ä–∏–¥—É–º–∞–π –∏–Ω—Ç–µ—Ä–µ—Å–Ω—É—é –±–∏–∑–Ω–µ—Å-–∏–¥–µ—é')">–ë–∏–∑–Ω–µ—Å-–∏–¥–µ—è</button><button class="sug" onclick="qs('–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–π—Ä–æ–Ω–Ω–∞—è —Å–µ—Ç—å?')">–ù–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–∏</button><button class="sug" onclick="qs('–ù–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–∏–π —Ä–∞—Å—Å–∫–∞–∑ –ø—Ä–æ –ò–ò')">–†–∞—Å—Å–∫–∞–∑ –ø—Ä–æ –ò–ò</button><button class="sug" onclick="qs('–ß—Ç–æ —Ç–∞–∫–æ–µ –±–ª–æ–∫—á–µ–π–Ω?')">–ë–ª–æ–∫—á–µ–π–Ω</button></div></div>`;
}

function addBubble(role, text, anim=true) {
  chatEl.querySelector('.welcome')?.remove();
  const el=document.createElement('div'); el.className=`msg ${role}`;
  if(!anim) el.style.animation='none';
  const av=document.createElement('div'); av.className='av';
  const p=getProfile();
  if(role==='user') {
    if(p.avatar) av.innerHTML=`<img src="${p.avatar}" style="width:100%;height:100%;object-fit:cover;border-radius:9px">`;
    else av.textContent='–í–´';
  } else { av.textContent='AI'; }
  const bub=document.createElement('div'); bub.className='bubble';
  bub.innerHTML=role==='ai'?mdParse(text):esc(text);
  el.appendChild(av); el.appendChild(bub);
  chatEl.appendChild(el); chatEl.scrollTop=chatEl.scrollHeight;
}

function showTyping() {
  const el=document.createElement('div'); el.className='msg ai'; el.id='typ';
  const av=document.createElement('div'); av.className='av'; av.textContent='AI';
  const b=document.createElement('div'); b.className='bubble';
  b.innerHTML='<div class="typing"><span></span><span></span><span></span></div>';
  el.appendChild(av); el.appendChild(b); chatEl.appendChild(el); chatEl.scrollTop=chatEl.scrollHeight;
}
function hideTyping() { document.getElementById('typ')?.remove(); }
function showErr(msg) {
  const el=document.createElement('div'); el.className='err-bubble'; el.textContent=msg;
  chatEl.appendChild(el); chatEl.scrollTop=chatEl.scrollHeight;
  setTimeout(()=>el.remove(),6000);
}

// ‚ïê‚ïê SEND ‚ïê‚ïê
async function sendMsg() {
  const text=inpEl.value.trim();
  if(!text||loading||spamLock) return;

  if(!activeCid) { const c=mkChat(); activeCid=c.id; }

  // –°–ø–∞–º-–∑–∞—â–∏—Ç–∞: –±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ 4 —Å–µ–∫—É–Ω–¥—ã
  spamLock=true; sndBtn.disabled=true;
  setTimeout(()=>{ spamLock=false; if(!loading) sndBtn.disabled=false; },4000);

  loading=true; setSt('loading');
  addBubble('user',text);
  inpEl.value=''; autoResize(inpEl);
  showTyping();

  const c=getChat(activeCid);
  c.messages.push({role:'user',content:text});
  if(c.messages.length===1) {
    c.title=text.length>42?text.slice(0,42)+'‚Ä¶':text;
    titleEl.textContent=c.title;
  }
  patchChat(activeCid,{messages:c.messages,title:c.title});

  // –°—á–∏—Ç–∞–µ–º –∑–∞–ø—Ä–æ—Å
  incReqs();

  const apiMessages=[
    {role:'system',content:SYS},
    ...c.messages.map(m=>({role:m.role,content:String(m.content||'')}))
  ];

  try {
    const res=await fetch(GROQ_URL,{
      method:'POST',
      headers:{'Content-Type':'application/json','Authorization':`Bearer ${GROQ_KEY}`},
      body:JSON.stringify({model,messages:apiMessages,temperature:.8,max_tokens:2048})
    });
    if(!res.ok){const e=await res.json().catch(()=>({}));throw new Error(e.error?.message||`–û—à–∏–±–∫–∞ ${res.status}`);}
    const data=await res.json();
    let reply=data.choices?.[0]?.message?.content||'–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç';
    reply=reply.replace(/<think>[\s\S]*?<\/think>/gi,'').trim();
    if(!reply) reply='(–º–æ–¥–µ–ª—å –Ω–µ –¥–∞–ª–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞)';
    hideTyping(); addBubble('ai',reply);
    c.messages.push({role:'assistant',content:reply});
    patchChat(activeCid,{messages:c.messages});
    setSt('');
  } catch(e) {
    hideTyping(); showErr('‚ö†Ô∏è '+e.message);
    c.messages.pop(); patchChat(activeCid,{messages:c.messages});
    setSt('error'); setTimeout(()=>setSt(''),3000);
  }

  loading=false;
  // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è 4 —Å–µ–∫ (spamLock)
  if(!spamLock) sndBtn.disabled=false;
  inpEl.focus();
}

function qs(t){inpEl.value=t;sendMsg();}

// ‚ïê‚ïê MODELS ‚ïê‚ïê
function toggleModels(){document.getElementById('msel').classList.toggle('open');}
function selModel(id,label){
  model=id; lss('riteom_model',{id,label});
  document.getElementById('mBadge').textContent=label+' ‚ñæ';
  document.querySelectorAll('.mo').forEach(o=>o.classList.remove('active'));
  event.currentTarget.classList.add('active');
  document.getElementById('msel').classList.remove('open');
}

// ‚ïê‚ïê UTILS ‚ïê‚ïê
function setSt(s){sdot.className='sdot'+(s?' '+s:'');}

let copyIdx=0;
function mdParse(t){
  return t
    .replace(/```(\w*)\n?([\s\S]*?)```/g,(_,lang,code)=>{
      const id='cp'+(++copyIdx), raw=code.trim();
      const enc=btoa(unescape(encodeURIComponent(raw)));
      return `<div class="pre-wrap"><button class="copy-btn" data-code="${enc}" onclick="copyCode(this)">–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button><pre><code id="${id}">${esc(raw)}</code></pre></div>`;
    })
    .replace(/`([^`]+)`/g,'<code>$1</code>')
    .replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
    .replace(/\*(.+?)\*/g,'<em>$1</em>')
    .replace(/^### (.+)$/gm,'<h3>$1</h3>')
    .replace(/^## (.+)$/gm,'<h2>$1</h2>')
    .replace(/^# (.+)$/gm,'<h1>$1</h1>')
    .replace(/^> (.+)$/gm,'<blockquote>$1</blockquote>')
    .replace(/^\- (.+)$/gm,'<li>$1</li>')
    .replace(/(<li>.*<\/li>\n?)+/g,m=>`<ul>${m}</ul>`)
    .replace(/^\d+\. (.+)$/gm,'<li>$1</li>')
    .replace(/\n\n/g,'</p><p>')
    .replace(/\n/g,'<br>');
}

function copyCode(btn){
  const enc=btn.getAttribute('data-code');
  let text;
  try { text=decodeURIComponent(escape(atob(enc))); } catch(e){ text=enc; }
  if(navigator.clipboard&&navigator.clipboard.writeText){
    navigator.clipboard.writeText(text).then(()=>flashCopied(btn)).catch(()=>fallbackCopy(text,btn));
  } else { fallbackCopy(text,btn); }
}
function fallbackCopy(text,btn){
  try {
    const ta=document.createElement('textarea'); ta.value=text;
    ta.style.cssText='position:fixed;top:-9999px;left:-9999px;opacity:0';
    document.body.appendChild(ta); ta.focus(); ta.select();
    document.execCommand('copy'); document.body.removeChild(ta); flashCopied(btn);
  } catch(e){ btn.textContent='–æ—à–∏–±–∫–∞'; setTimeout(()=>btn.textContent='–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å',1500); }
}
function flashCopied(btn){
  btn.textContent='‚úì —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ'; btn.classList.add('copied');
  setTimeout(()=>{ btn.textContent='–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å'; btn.classList.remove('copied'); },2000);
}

function esc(t){return String(t).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function handleKey(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMsg();}}
function autoResize(el){el.style.height='auto';el.style.height=Math.min(el.scrollHeight,140)+'px';}

document.getElementById('adminOverlay').addEventListener('click', e => { if(e.target===document.getElementById('adminOverlay')) closeOverlay('adminOverlay'); });
document.getElementById('keyOverlay').addEventListener('click', e => { if(e.target===document.getElementById('keyOverlay')) closeOverlay('keyOverlay'); });

document.addEventListener('click',e=>{
  if(!e.target.closest('.model-badge')&&!e.target.closest('.msel'))
    document.getElementById('msel').classList.remove('open');
});

// ‚ïê‚ïê ACTIVATION KEYS ‚ïê‚ïê
const VALID_KEYS = ['tretxinosmeo928','ybrubrsodnaoe823','jythshbwdfki81349'];

function isActivated() { return ls('riteom_activated', false); }
function setActivated() { lss('riteom_activated', true); }

function openKeyOverlay() {
  if (isActivated()) {
    // Already activated ‚Üí open admin
    closeOverlay('chatOverlay');
    openAdminPanel();
    return;
  }
  document.getElementById('keyInp').value = '';
  document.getElementById('keyErr').style.display = 'none';
  document.getElementById('keyOk').style.display = 'none';
  closeOverlay('chatOverlay');
  openOverlay('keyOverlay');
}

function submitKey() {
  const val = document.getElementById('keyInp').value.trim();
  const errEl = document.getElementById('keyErr');
  const okEl = document.getElementById('keyOk');
  errEl.style.display = 'none';
  okEl.style.display = 'none';
  if (VALID_KEYS.includes(val)) {
    setActivated();
    okEl.style.display = 'block';
    updateKeyBtnState();
    setTimeout(() => {
      closeOverlay('keyOverlay');
      openAdminPanel();
    }, 1200);
  } else {
    errEl.style.display = 'block';
    document.getElementById('keyInp').value = '';
    document.getElementById('keyInp').focus();
  }
}

function updateKeyBtnState() {
  const btn = document.getElementById('keyNavBtn');
  const label = document.getElementById('keyNavLabel');
  if (btn && label) {
    if (isActivated()) {
      btn.classList.add('activated');
      label.textContent = '‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å';
    } else {
      btn.classList.remove('activated');
      label.textContent = '–ö–ª—é—á –∞–∫—Ç–∏–≤–∞—Ü–∏–∏';
    }
  }
}

// ‚ïê‚ïê ADMIN PANEL ‚ïê‚ïê
function openAdminPanel() {
  const p = getProfile();
  document.getElementById('adminNameInp').value = p.name || '';
  document.getElementById('adminNftSelect').value = '0';
  document.getElementById('adminCustomNft').style.display = 'none';
  document.getElementById('adminNftMsg').style.display = 'none';
  document.getElementById('adminNameMsg').style.display = 'none';
  renderAdminNftList();
  openOverlay('adminOverlay');
  // nft select toggle
  document.getElementById('adminNftSelect').onchange = function() {
    document.getElementById('adminCustomNft').style.display = this.value === 'custom' ? 'flex' : 'none';
  };
}

function adminSaveName() {
  const name = document.getElementById('adminNameInp').value.trim();
  const p = getProfile(); p.name = name; saveProfileData(p);
  updateMenuName(name);
  const msg = document.getElementById('adminNameMsg');
  msg.textContent = '‚úì –ò–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!';
  msg.className = 'admin-msg success';
  msg.style.display = 'block';
  setTimeout(() => msg.style.display = 'none', 2000);
}

function adminAddNft() {
  const sel = document.getElementById('adminNftSelect').value;
  const msg = document.getElementById('adminNftMsg');
  let nft;
  if (sel === 'custom') {
    const emoji = document.getElementById('adminNftEmoji').value.trim() || 'üèÜ';
    const name = document.getElementById('adminNftName').value.trim() || 'Custom NFT';
    const val = parseInt(document.getElementById('adminNftVal').value) || 500;
    const grow = parseInt(document.getElementById('adminNftGrow').value) || 100;
    // Add custom to NFT_DEFS temporarily
    const customDef = { emoji, name, rarity:'Admin', baseVal: val, dailyGrow: grow, trigger:'admin' };
    NFT_DEFS.push(customDef);
    nft = { defIdx: NFT_DEFS.length - 1, issuedAt: Date.now() };
  } else {
    nft = { defIdx: parseInt(sel), issuedAt: Date.now() };
  }
  const nfts = getNfts();
  nfts.push(nft);
  saveNfts(nfts);
  const def = NFT_DEFS[nft.defIdx];
  msg.textContent = `‚úÖ NFT "${def.name}" –¥–æ–±–∞–≤–ª–µ–Ω!`;
  msg.className = 'admin-msg success';
  msg.style.display = 'block';
  setTimeout(() => msg.style.display = 'none', 2500);
  renderAdminNftList();
  // Update stats if profile is open
  document.getElementById('statNfts').textContent = getNfts().length;
}

function adminDeleteNft(idx) {
  const nfts = getNfts();
  nfts.splice(idx, 1);
  saveNfts(nfts);
  renderAdminNftList();
  document.getElementById('statNfts').textContent = getNfts().length;
}

function renderAdminNftList() {
  const list = document.getElementById('adminNftList');
  const nfts = getNfts();
  if (!nfts.length) {
    list.innerHTML = '<div class="nft-empty">NFT –ø–æ–∫–∞ –Ω–µ—Ç.</div>';
    return;
  }
  list.innerHTML = '';
  [...nfts].reverse().forEach((nft, ri) => {
    const realIdx = nfts.length - 1 - ri;
    const def = NFT_DEFS[nft.defIdx];
    if (!def) return;
    const row = document.createElement('div');
    row.className = 'admin-nft-row';
    row.innerHTML = `
      <div class="anr-emoji">${def.emoji}</div>
      <div class="anr-name">${def.name}</div>
      <button class="anr-del" onclick="adminDeleteNft(${realIdx})">üóë</button>`;
    list.appendChild(row);
  });
}

// ‚ïê‚ïê INIT KEY STATE ‚ïê‚ïê
document.addEventListener('DOMContentLoaded', () => {});
// Called in INIT section below


(function(){
  // –ú–æ–¥–µ–ª—å
  try {
    const saved=ls('riteom_model',null);
    if(saved&&saved.id){
      model=saved.id;
      document.getElementById('mBadge').textContent=saved.label+' ‚ñæ';
      document.querySelectorAll('.mo').forEach(o=>{
        if((o.getAttribute('onclick')||'').includes(saved.id)) o.classList.add('active');
        else o.classList.remove('active');
      });
    }
  } catch(e){}

  // Key btn state
  updateKeyBtnState();

  // –ü—Ä–æ—Ñ–∏–ª—å
  const p=getProfile();
  updateAvatarUI(p.avatar||'');
  updateMenuName(p.name||'');

  // –°—á—ë—Ç—á–∏–∫
  updateCounterUI(getTotalReqs());

  // –ß–∞—Ç—ã
  const cs=allChats();
  if(cs.length){activeCid=cs[0].id;loadChat(activeCid);}
  else{showWelcome();titleEl.textContent='Riteom AI';}
  inpEl.focus();
})();
</script>
</body>
</html>
